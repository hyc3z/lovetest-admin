# 导出功能升级

## 概述

导出功能已升级为带预览的高级导出系统，支持模式匹配和正则表达式筛选。

## 新功能特性

### 🎯 模式筛选
- **留空导出全部** - 不输入任何模式，导出所有激活码
- **模糊匹配** - 输入文本，匹配包含该文本的激活码
- **正则表达式** - 勾选"使用正则表达式"，使用高级匹配

### 👀 预览功能
- 显示匹配数量
- 预览前 10 条激活码
- 显示最后 1 条激活码
- 中间省略显示

### 📦 导出格式
- 纯文本文件（.txt）
- 每行一个激活码
- 文件名包含时间戳和模式

## 使用方法

### 1. 导出全部激活码

```
1. 点击"导出"按钮
2. 不输入任何模式（留空）
3. 点击"预览匹配结果"
4. 查看预览，确认无误
5. 点击"导出激活码"
```

### 2. 模糊匹配导出

```
1. 点击"导出"按钮
2. 输入文本，例如：TEST
3. 不勾选"使用正则表达式"
4. 点击"预览匹配结果"
5. 查看匹配的激活码
6. 点击"导出激活码"
```

**示例：**
- 输入 `TEST` → 匹配所有包含 "TEST" 的激活码
- 输入 `2024` → 匹配所有包含 "2024" 的激活码
- 输入 `DEMO-` → 匹配所有包含 "DEMO-" 的激活码

### 3. 正则表达式导出

```
1. 点击"导出"按钮
2. 输入正则表达式
3. 勾选"使用正则表达式"
4. 点击"预览匹配结果"
5. 查看匹配的激活码
6. 点击"导出激活码"
```

**示例：**
- `^TEST-.*` → 以 TEST- 开头的激活码
- `.*-2024$` → 以 -2024 结尾的激活码
- `^DEMO-\d+$` → DEMO- 后跟数字的激活码
- `^(TEST|DEMO)-.*` → 以 TEST- 或 DEMO- 开头的激活码

## 预览界面

### 显示内容
```
找到 156 个匹配的激活码

预览（前10条和最后1条）：
1. TEST-ABC123
2. TEST-DEF456
3. TEST-GHI789
...
... (145 项)
...
156. TEST-XYZ999
```

### 信息提示
- 💡 所有匹配的激活码将导出到文本文件
- 📊 显示匹配总数
- 🔍 预览前 10 条和最后 1 条

## 文件命名

导出的文件名格式：
```
activation-codes-{pattern}-{timestamp}.txt
```

**示例：**
- `activation-codes-2024-11-21T10-30-00.txt` （全部导出）
- `activation-codes-TEST-2024-11-21T10-30-00.txt` （模式：TEST）
- `activation-codes-DEMO-2024-11-21T10-30-00.txt` （模式：DEMO）

## 技术实现

### 组件结构
```
ExportCodes.tsx       - 导出组件
ExportCodes.css       - 导出样式
```

### 工作流程
```
输入模式 → 预览匹配 → 确认导出 → 下载文件
```

### API 调用
使用批量删除的预览接口（`dryRun: true`）来获取匹配的激活码：

```typescript
const result = await apiService.batchDeleteCodes({
  pattern: finalPattern,
  dryRun: true,
});
```

### 模式转换
```typescript
// 空模式 → 匹配所有
'' → '.*'

// 模糊匹配 → 包含子串
'TEST' → '.*TEST.*'

// 正则表达式 → 直接使用
'^TEST-.*' → '^TEST-.*'
```

## 与批量删除的对比

| 功能 | 批量删除 | 导出 |
|------|---------|------|
| 模式匹配 | ✅ | ✅ |
| 正则表达式 | ✅ | ✅ |
| 预览功能 | ✅ | ✅ |
| 空模式 | ❌ 必须输入 | ✅ 导出全部 |
| 预览显示 | 前 10 条 | 前 10 + 最后 1 条 |
| 操作结果 | 删除激活码 | 下载文件 |
| 危险程度 | ⚠️ 高 | ✅ 安全 |

## 优势

### 相比旧版导出
1. **更灵活** - 支持模式筛选，不只是导出全部
2. **更安全** - 预览后再导出，避免错误
3. **更直观** - 显示匹配数量和预览内容
4. **更强大** - 支持正则表达式高级匹配
5. **更友好** - 统一的 UI 风格和交互

### 使用场景
- 📊 **定期备份** - 导出全部激活码
- 🔍 **按前缀导出** - 导出特定前缀的激活码
- 📅 **按日期导出** - 导出特定日期的激活码
- 🏷️ **按类型导出** - 导出特定类型的激活码
- 🧪 **测试数据** - 导出测试用的激活码

## 示例用例

### 用例 1：导出所有测试激活码
```
模式：TEST
正则：❌
结果：所有包含 "TEST" 的激活码
```

### 用例 2：导出 2024 年的激活码
```
模式：.*-2024$
正则：✅
结果：所有以 "-2024" 结尾的激活码
```

### 用例 3：导出特定前缀
```
模式：^PROD-
正则：✅
结果：所有以 "PROD-" 开头的激活码
```

### 用例 4：导出未使用的激活码
```
模式：UNUSED
正则：❌
结果：所有包含 "UNUSED" 的激活码
```

## 键盘快捷键

- **ESC** - 关闭导出窗口
- **Enter** - 在输入框中按 Enter 不会提交（避免误操作）

## 多语言支持

- ✅ 中文界面
- ✅ 英文界面
- ✅ 自动切换

## 未来扩展

可以添加的功能：
- 导出格式选择（CSV, JSON, Excel）
- 导出字段选择（只导出激活码，或包含状态、时间等）
- 批量导出（多个模式）
- 定时导出
- 导出历史记录

## 注意事项

1. **预览限制** - 只显示前 10 条和最后 1 条，但导出时会包含所有匹配的激活码
2. **正则语法** - 使用标准的正则表达式语法
3. **性能考虑** - 大量激活码时，预览和导出可能需要一些时间
4. **浏览器兼容** - 使用现代浏览器以获得最佳体验

## 故障排查

### 预览失败
- 检查正则表达式语法是否正确
- 检查网络连接
- 查看浏览器控制台错误

### 导出失败
- 检查浏览器下载设置
- 确保有足够的磁盘空间
- 尝试使用较小的数据集

### 匹配数量为 0
- 检查模式是否正确
- 尝试使用模糊匹配而不是正则
- 确认数据库中有匹配的激活码
